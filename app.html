<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
</head>

<body>
    <div class="main">
        <div class="title" id="title">
            <a class="download-btn" id="openIntentLink" href="intent://www.hynal.com/app.html#Intent;scheme=wandaappfeifan;package=com.wanda.app.wanhui;end">下载飞凡客户端</a>
        </div>
    </div>
    <script>
    // var mobileAppInstall = (function() {
    //     var ua = navigator.userAgent,
    //         loadIframe, win = window;

    //     function getIntentIframe() {
    //         if (!loadIframe) {
    //             var iframe = document.createElement("iframe");
    //             iframe.style.cssText = "display:none;width:0px;height:0px;";
    //             document.body.appendChild(iframe);
    //             loadIframe = iframe;
    //         }
    //         return loadIframe;
    //     }

    //     function getChromeIntent(url) {
    //         return "intent://www.hynal.com/app.html#Intent;scheme=" + url + ";package=com.wanda.app.wanhui;end";
    //     }
    //     var appInstall = {
    //         isChrome: ua.match(/Chrome\/([\d.]+)/) || ua.match(/CriOS\/([\d.]+)/),
    //         isAndroid: ua.match(/(Android);?[\s\/]+([\d.]+)?/),
    //         timeout: 5000,
    //         /** * 尝试跳转appurl,如果跳转失败，进入h5url * @param {Object} appurl 应用地址 * @param {Object} h5url http地址 */
    //         open: function(appurl, h5url) {
    //             var t = Date.now();
    //             appInstall.openApp(appurl);
    //             setTimeout(function() {
    //                 if (Date.now() - t < appInstall.timeout + 100) {
    //                     h5url && appInstall.openH5(h5url);
    //                 }
    //             }, appInstall.timeout)
    //         },
    //         openApp: function(appurl) {
    //             if (appInstall.isChrome) {
    //                 if (appInstall.isAndroid) {
    //                     win.location.href = getChromeIntent(appurl);
    //                     console.log(appInstall.isAndroid);
    //                 } else {
    //                     win.location.href = appurl;
    //                     console.log("no android");
    //                 }
    //             } else {
    //                 getIntentIframe().src = appurl;
    //                  console.log("no iphone");
    //             }
    //         },
    //         openH5: function(h5url) {
    //             // win.location.href = h5url;
    //         }
    //     }
    //     return appInstall;
    // })();
    // console.log(mobileAppInstall);
    // var downloadUrl = "http://a.app.qq.com/o/simple.jsp?pkgname=com.wanda.app.wanhui",
    //     schemeUrl = "wandaappfeifan";
    //mobileAppInstall.open(schemeUrl, downloadUrl);
    </script>
    <script>
    if (typeof FeifanWallet !== 'object') {
        FeifanWallet = {};
    }

    (function() {
        var ua = navigator.userAgent.toLowerCase(),
            locked = false,
            domLoaded = document.readyState === 'complete',
            delayToRun;

        function customClickEvent() {
            var clickEvt;
            if (window.CustomEvent) {
                clickEvt = new window.CustomEvent('click', {
                    canBubble: true,
                    cancelable: true
                });
            } else {
                clickEvt = document.createEvent('Event');
                clickEvt.initEvent('click', true, true);
            }
            console.log(clickEvt);
            return clickEvt;
        }

        function getAndroidVersion() {
            var match = ua.match(/android\s([0-9\.]*)/);
            return match ? match[1] : false;
        }

        var noIntentTest = /360 aphone|weibo|windvane|ucbrowser|baidubrowser/.test(ua);
        var hasIntentTest = /chrome|samsung/.test(ua);
        var isAndroid = /android|adr/.test(ua) && !(/windows phone/.test(ua));
        var canIntent = !noIntentTest && hasIntentTest && isAndroid;
        var openInIfr = /weibo|m353/.test(ua);
        var inWeibo = ua.indexOf('weibo') > -1;

        if (ua.indexOf('m353') > -1 && !noIntentTest) {
            canIntent = false;
        }

        // 是否在 webview
        var inWebview = '';
        if (inWebview) {
            canIntent = false;
        }


        /**
         * 打开app
         * @param   {string}    params  唤起钱包的参数设置('alipays://platformapi/startapp?'后面的值)
         * @param   {boolean}   jumpUrl 唤起钱包后，android下要跳转到的URL；
         *                      若传"default"，则为http://a.app.qq.com/o/simple.jsp?pkgname=com.wanda.app.wanhui
         */
        FeifanWallet.open = function(params, jumpUrl) {
            if (!domLoaded && (ua.indexOf('360 aphone') > -1 || canIntent)) {
                var arg = arguments;
                delayToRun = function() {
                    FeifanWallet.open.apply(null, arg);
                    delayToRun = null;
                };
                return;
            }

            // 唤起锁定，避免重复唤起
            if (locked) {
                return;
            }
            locked = true;

            var o;
            // 参数容错
            if (typeof params === 'object') {
                o = params;
            } else {
                o = {
                    params: params,
                    jumpUrl: jumpUrl
                };
            }

            // 参数容错
            if (typeof o.params !== 'string') {
                o.params = '';
            }
            if (typeof o.openAppStore !== 'boolean') {
                o.openAppStore = true;
            }

            if (o.params.indexOf('startapp?') > -1) {
                o.params = o.params.split('startapp?')[1];
            } else if (o.params.indexOf('startApp?') > -1) {
                o.params = o.params.split('startApp?')[1];
            }


            // 通过wandaappfeifan协议唤起钱包
            var schemePrefix = "wandaappfeifan";
            // if (ua.indexOf('mac os') > -1 && ua.indexOf('mobile') > -1) {

            // }
            // schemePrefix = schemePrefix || 'wandaappfeifan';


            if (!canIntent) {
                // var feifanUrl = schemePrefix + '://h2/app?' + o.params;
                var feifanUrl = schemePrefix + '://';

                if (ua.indexOf('qq/') > -1 || (ua.indexOf('safari') > -1 && ua.indexOf('os 9_') > -1)) {
                    var openSchemeLink = document.getElementById('openSchemeLink');
                    if (!openSchemeLink) {
                        openSchemeLink = document.createElement('a');
                        openSchemeLink.id = 'openSchemeLink';
                        openSchemeLink.style.display = 'none';
                        document.body.appendChild(openSchemeLink);
                    }
                    openSchemeLink.href = feifanUrl;
                    // 执行click
                    openSchemeLink.dispatchEvent(customClickEvent());
                } else {
                    var ifr = document.createElement('iframe');
                    ifr.src = feifanUrl;
                    ifr.style.display = 'none';
                    document.body.appendChild(ifr);
                }
            } else {
                // android 下 chrome 浏览器通过 intent 协议唤起钱包
                var packageKey = 'com.wanda.app.wanhui';

                var intentUrl = 'intent://m.ffan.com/app.html?' + o.params + '#Intent;scheme=' + schemePrefix + ';package=com.eg.android.' + packageKey + ';end';

                var openIntentLink = document.getElementById('openIntentLink');
                if (!openIntentLink) {
                    openIntentLink = document.createElement('a');
                    openIntentLink.id = 'openIntentLink';
                    openIntentLink.style.display = 'none';
                    document.body.appendChild(openIntentLink);
                }
                openIntentLink.href = intentUrl;
                // 执行click
                openIntentLink.dispatchEvent(customClickEvent());
            }

            // 延迟移除用来唤起钱包的IFRAME并跳转到下载页
            setTimeout(function() {
                if (typeof o.jumpUrl !== 'string') {
                    o.jumpUrl = '';
                }

                // 默认跳转地址
                if (o.jumpUrl === 'default') {
                    o.jumpUrl = 'http://a.app.qq.com/o/simple.jsp?pkgname=com.wanda.app.wanhui';
                }

                if (o.jumpUrl && typeof o.jumpUrl === 'string') {
                    location.href = o.jumpUrl;
                }
            }, 1000)


            // 唤起加锁，避免短时间内被重复唤起
            setTimeout(function() {
                locked = false;
            }, 2500)
        }

        if (!domLoaded) {
            document.addEventListener('DOMContentLoaded', function() {
                domLoaded = true;
                if (typeof delayToRun === 'function') {
                    delayToRun();
                }
            }, false);
        }
    })();
    FeifanWallet.open({
        params: "",
        jumpUrl: '',
        openAppStore: false
    });
    </script>
</body>

</html>
